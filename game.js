var sensordata = [
    {
        "deviceid": 0,
        "x": 3105.5064502509,
        "y": 1848.2402298074
    },
    {
        "deviceid": 1,
        "x": 2923.1398724756,
        "y": 1833.96304726
    },
    {
        "deviceid": 2,
        "x": 3887.3458826325,
        "y": 1334.6310080482
    },
    {
        "deviceid": 3,
        "x": 4182.7261872183,
        "y": 1350.4393679275
    },
    {
        "deviceid": 4,
        "x": 4331.192525201,
        "y": 1355.6760813151
    },
    {
        "deviceid": 5,
        "x": 3895.0142949156,
        "y": 1493.3992194262
    },
    {
        "deviceid": 6,
        "x": 4205.1536559049,
        "y": 1499.382404021
    },
    {
        "deviceid": 7,
        "x": 4338.945646574,
        "y": 1510.8380470545
    },
    {
        "deviceid": 8,
        "x": 2080.4257499304,
        "y": 1380.6912041687
    },
    {
        "deviceid": 9,
        "x": 2372.3778897479,
        "y": 1505.9710350503
    },
    {
        "deviceid": 10,
        "x": 3087.7228442104,
        "y": 1536.6891690568
    },
    {
        "deviceid": 11,
        "x": 2907.7078278775,
        "y": 1537.0699309483
    },
    {
        "deviceid": 12,
        "x": 2705.7753970699,
        "y": 1481.4991806382
    },
    {
        "deviceid": 13,
        "x": 2910.6063361551,
        "y": 1383.017043013
    },
    {
        "deviceid": 14,
        "x": 4041.7331871628,
        "y": 1344.2581876378
    },
    {
        "deviceid": 15,
        "x": 4026.5392203177,
        "y": 1519.2627905928
    },
    {
        "deviceid": 16,
        "x": 4183.6677270568,
        "y": 1346.8570161011
    },
    {
        "deviceid": 17,
        "x": 3880.6501403399,
        "y": 1506.8059852997
    },
    {
        "deviceid": 18,
        "x": 4323.1723600771,
        "y": 1515.6452872039
    },
    {
        "deviceid": 19,
        "x": 3723.039866458,
        "y": 1778.2684947709
    },
    {
        "deviceid": 20,
        "x": 4343.9756894134,
        "y": 1766.881110585
    },
    {
        "deviceid": 21,
        "x": 4182.7933246773,
        "y": 1779.9502102105
    },
    {
        "deviceid": 22,
        "x": 3092.1701359507,
        "y": 1007.4092547962
    },
    {
        "deviceid": 23,
        "x": 4168.0631130973,
        "y": 1005.4410038927
    },
    {
        "deviceid": 24,
        "x": 3965.4478940825,
        "y": 984.1595283424
    },
    {
        "deviceid": 25,
        "x": 4036.6137304075,
        "y": 1345.2226287623
    },
    {
        "deviceid": 26,
        "x": 4044.7010466083,
        "y": 1508.3475471295
    },
    {
        "deviceid": 27,
        "x": 3402.0,
        "y": 1843.0
    },
    {
        "deviceid": 28,
        "x": 3251.3581246533,
        "y": 1842.1530648461
    },
    {
        "deviceid": 29,
        "x": 2791.2399675972,
        "y": 1835.2002159768
    },
    {
        "deviceid": 30,
        "x": 2657.9716283903,
        "y": 1821.6472983517
    },
    {
        "deviceid": 31,
        "x": 2368.7543560151,
        "y": 1382.7779365053
    },
    {
        "deviceid": 32,
        "x": 2209.3054066973,
        "y": 1373.8198489325
    },
    {
        "deviceid": 33,
        "x": 1942.0,
        "y": 1380.0
    },
    {
        "deviceid": 34,
        "x": 2095.8081812038,
        "y": 1525.2690914013
    },
    {
        "deviceid": 35,
        "x": 2232.1754723338,
        "y": 1509.9233162312
    },
    {
        "deviceid": 36,
        "x": 1965.1717202607,
        "y": 1526.012800676
    },
    {
        "deviceid": 37,
        "x": 2444.4753049197,
        "y": 1829.048321257
    },
    {
        "deviceid": 38,
        "x": 1840.3070357402,
        "y": 1832.6491962217
    },
    {
        "deviceid": 39,
        "x": 2290.7536875252,
        "y": 1836.3263549399
    },
    {
        "deviceid": 40,
        "x": 1983.1786201571,
        "y": 1829.6576346156
    },
    {
        "deviceid": 41,
        "x": 2581.2977100297,
        "y": 1467.2885201921
    },
    {
        "deviceid": 42,
        "x": 3075.7684845136,
        "y": 1388.3967338328
    },
    {
        "deviceid": 43,
        "x": 2710.9272135755,
        "y": 1384.162407897
    },
    {
        "deviceid": 44,
        "x": 2561.3951606268,
        "y": 1381.0790723245
    },
    {
        "deviceid": 45,
        "x": 3876.9163400009,
        "y": 1350.8785656055
    },
    {
        "deviceid": 46,
        "x": 4317.6860379916,
        "y": 1350.6546336053
    },
    {
        "deviceid": 47,
        "x": 4174.9757808072,
        "y": 1520.278501706
    },
    {
        "deviceid": 48,
        "x": 3876.3622575887,
        "y": 1774.7871903483
    },
    {
        "deviceid": 49,
        "x": 4022.1419273144,
        "y": 1785.4242767321
    },
    {
        "deviceid": 50,
        "x": 3242.4587384119,
        "y": 996.4176920446
    },
    {
        "deviceid": 51,
        "x": 3508.7236228305,
        "y": 986.8464667554
    },
    {
        "deviceid": 52,
        "x": 3652.7456493639,
        "y": 985.5302925457
    },
    {
        "deviceid": 53,
        "x": 3386.0811726138,
        "y": 984.7332994588
    },
    {
        "deviceid": 54,
        "x": 3793.9415209221,
        "y": 981.5316404667
    },
    {
        "deviceid": 55,
        "x": 4315.0,
        "y": 1008.0
    }
]



var GameScene = new Phaser.Class({

    Extends: Phaser.Scene,

    initialize:

    function GameScene ()
    {
        Phaser.Scene.call(this, { key: 'GameScene' });
    },

    preload: function ()
    {
        this.load.image('bg', 'site_1_s.png');
        this.load.image('crate', 'assets/sprites/crate.png');
        this.load.atlas('shapes', 'assets/shapes.png', 'assets/shapes.json');
        this.load.text('particle-effect', 'assets/particle-effect.json');
    },

    create: function ()
    {
        this.add.image(659, 329.5, 'bg');

        // for (var i = 0; i < 64; i++)
        // {
        //     var x = Phaser.Math.Between(0, 800);
        //     var y = Phaser.Math.Between(0, 600);

        //     var box = this.add.image(x, y, 'crate');

        //     //  Make them all input enabled
        //     box.setInteractive();
        // }

        var sensorCoords = [];

        sensordata.forEach(function(sensor) {
            sensorCoords.push(sensor);
        });

        var selectedSensorIndex = 0;

        // Draw sensors
        sensors = sensorCoords.forEach(function(sensor, index) {
            var x = sensor.x;
            var y = sensor.y;
            var radius = 10;
            var color = 0xff0000;
            var alpha = 1;
            var sensorobj = this.add.circle(x/4, y/4, radius, color, alpha);
            sensorobj.id = sensor.deviceid;
            sensorobj.setInteractive();
            this.input.setDraggable(sensorobj);
            return sensorobj
            // sensor.on('pointerdown', this.clickHandler, this);
        }, this);

        this.add.particles('shapes',  new Function('return ' + this.cache.text.get('particle-effect'))());

        this.input.on('gameobjectup', this.clickHandler, this);
        this.input.on('dragstart', function (pointer, gameObject) {

            // gameObject.setTint(0xff0000);
    
        });
    
        this.input.on('drag', function (pointer, gameObject, dragX, dragY) {
    
            gameObject.x = dragX;
            gameObject.y = dragY;
    
        });
    
        this.input.on('dragend', function (pointer, gameObject) {
    
            // gameObject.clearTint();
    
        });
    },

    clickHandler: function (pointer, sensor)
    {
        //  Disable our box
        // box.input.enabled = false;
        // box.setVisible(false);
        console.log(sensor.id)

        //  Dispatch a Scene event
        this.events.emit('selectBox', sensor);
    }

});

var UIScene = new Phaser.Class({

    Extends: Phaser.Scene,

    initialize:

    function UIScene ()
    {
        Phaser.Scene.call(this, { key: 'UIScene', active: true });

        this.score = 0;
    },

    create: function ()
    {
        //  Our Text object to display the Score
        var info = this.add.text(10, 10, 'Sensor: 0', { font: '48px Arial', fill: '#ffffff' });

        //  Grab a reference to the Game Scene
        var ourGame = this.scene.get('GameScene');

        //  Listen for events from it
        ourGame.events.on('selectBox', function (sensor) {

            this.score = sensor.id;

            info.setText('Sensor: ' + this.score);

        }, this);
    }

});

var config = {
    type: Phaser.AUTO,
    width: 1350,
    height: 700,
    backgroundColor: '#000000',
    parent: 'gamediv',
    scene: [ GameScene, UIScene ]
};

var game = new Phaser.Game(config);
